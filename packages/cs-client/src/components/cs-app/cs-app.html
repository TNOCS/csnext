<v-app v-resize="onResize" v-if="app.isInitialized" :dark="app.project.theme.dark" :light="!app.project.theme.dark">

  <v-toolbar color="primary" :floating="app.project.navigation.floating" :class="{'floating-toolbar': app.project.navigation.floating}"
    :clipped-left="leftSidebar && leftSidebar.clipped" absolute :dense="app.project.header.dense" app>
    <v-toolbar-side-icon v-if="leftSidebar" @click="leftSidebar.open = !leftSidebar.open"></v-toolbar-side-icon>
    <img v-if="app.project.header.logo" :src="app.project.header.logo" class="app-project-logo"></img>
    <div class="header-title-container">
      <v-breadcrumbs class="header-breadcrumbs" v-if="app.project.header.breadcrumbs && !app.project.header.dense">
        <v-icon slot="divider">chevron_right</v-icon>
        <v-breadcrumbs-item v-for="item in app.project.header.breadcrumbItems" :key="item">
          {{ item}}
        </v-breadcrumbs-item>
      </v-breadcrumbs>
      <v-toolbar-title class="header-title" v-if="!app.project.navigation.hideTitle">{{app.project.header.title}}</v-toolbar-title>
    </div>

    <v-tabs v-if="app.project.navigation.style==='tabs'" color="primary" class="cs-navigation-tabbar">
      <v-tab v-for="dashboard in app.project.dashboards" router="true" :key="dashboard.id" :to="dashboard.path">{{dashboard.title}}</v-tab>
    </v-tabs>
    <v-spacer></v-spacer>
    <v-btn v-if="app.project.search" icon>
      <v-icon>search</v-icon>
    </v-btn>

    <v-menu offset-x :close-on-content-click="false" :nudge-width="200" v-model="showNotifications">
      <v-badge slot="activator" color="red" overlap>
        <span v-if="unReadNotifications.length>0" slot="badge">{{ unReadNotifications.length }}</span>
        <v-icon>message</v-icon>
      </v-badge>
      <!-- <v-btn color="indigo" dark >Menu as Popover</v-btn> -->
      <v-card>
        <v-toolbar-title>Notifications</v-toolbar-title>
        <v-divider></v-divider>
        <v-list two-line>
          <template v-for="item in unReadNotifications">
            <v-list-tile avatar ripple @click="SelectNotification(item)" :key="item.id">
              <v-list-tile-content>
                <v-list-tile-title>{{ item.title }}</v-list-tile-title>
                <v-list-tile-sub-title class="text--primary">{{ item.text }}</v-list-tile-sub-title>
              </v-list-tile-content>
              <v-list-tile-action @click="item.isRead = true; UpdateNotifications()">
                <v-list-tile-action-text>{{ item.actionTitle }}</v-list-tile-action-text>
                <v-icon color="yellow darken-2">delete</v-icon>
              </v-list-tile-action>
            </v-list-tile>
            <!-- <v-divider v-if="index + 1 < app.project.notifications.items.length" :key="index"></v-divider> -->
          </template>
        </v-list>
        <v-card-actions>
          <v-spacer></v-spacer>
          <v-btn flat @click="showNotifications = false">Close</v-btn>
        </v-card-actions>
      </v-card>
    </v-menu>

    <v-menu v-for="menu in app.project.menus" :key="menu.id" :close-on-content-click="false" v-if="menu.visible" class="app-menu" offset-y>
      <v-btn icon slot="activator" :dark="app.project.theme.dark" @click.delegate="activateMenu(menu)">
        <v-icon>{{menu.icon}}</v-icon>
      </v-btn>
      <v-list v-if="menu.items && menu.items.length>0">
        <v-list-tile v-for="menuItem in menu.items" :key="menuItem.title" v-if="menuItem.visible" @click.delegate="activateMenu(menuItem)">
          <v-list-tile-title>{{ menuItem.title }}</v-list-tile-title>
        </v-list-tile>
      </v-list>
      <v-card v-if="menu.component">
        <component :is="menu.component" :data="menu.data"></component>
      </v-card>
    </v-menu>



    <v-menu bottom left>
      <v-btn icon slot="activator" :dark="app.project.theme.dark">
        <v-icon>more_vert</v-icon>
      </v-btn>
      <v-list>
        <v-list-tile v-for="setting in settings" :key="setting.id" @click="">
          <v-list-tile-title>{{ setting.title }}</v-list-tile-title>
        </v-list-tile>
      </v-list>
    </v-menu>

    <v-btn v-if="app.project.rightSidebar" @click="app.project.rightSidebar.open=!app.project.rightSidebar.open" icon>
      <v-icon v-if="app.project.rightSidebar.open">keyboard_arrow_right</v-icon>
      <v-icon v-if="!app.project.rightSidebar.open">keyboard_arrow_left</v-icon>
    </v-btn>
  </v-toolbar>

  <cs-sidebar v-if="leftSidebar" :sideBar="leftSidebar"></cs-sidebar>
  <cs-sidebar v-if="rightSidebar" :sideBar="rightSidebar"></cs-sidebar>

  <v-content fluid v-bind:class="{ 'floating': app.project.navigation.floating }" v-touch="{
    left: () => swipe('Left'),
    right: () => swipe('Right')
  }">
    <router-view :key="$route.path">
    </router-view>
  </v-content>

  <v-snackbar :timeout="lastNotification.timeout" :top="true" :multi-line="true" v-model="lastNotification._visible">
    {{ lastNotification.title }}
    <v-btn flat @click.native="lastNotification._visible = false">Close</v-btn>
  </v-snackbar>
</v-app>
